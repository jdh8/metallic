int __rem_pio2(double x, double y[static 2]);

/* Restriction of (x -> 1 - √x cot(√x)) to [0, (π/4)^2] */
static double _kernel(double greater, double lesser)
{
    const double c[] = {
        3.00000000000000005325072509816406070394204141210907953732440744688026027178368     ,
       -1.200000000000011007353350141401211622937718810161512800074133288324544640258077    ,
       -5.714285713912489163920563081554335826789420779383272739590394432731304597509321e-03,
       -2.53968258786329490978316752181301152479293973742247239921531028408125943821269e-04 ,
       -1.220363883903093212046798757962477792365011044490756443780176525448124904095217e-05,
       -5.988709719646459216720465495708919700965915258369790824492156354419674764377663e-07,
       -2.936716524262713922866591026010250796110839585807020806330553453994569919795868e-08,
       -1.655443018375790857397143953373812605435724833208286278045280408407952364131643e-09
    };

    double y = greater + lesser;
    double x = y * y;
    double xx = x * x;
    double r = x / (c[0] + c[1] * x + (c[2] + c[3] * x) * xx + (c[4] + c[5] * x + (c[6] + c[7] * x) * xx) * (xx * xx));
    double t = r * y + lesser + greater;

    return t * t * lesser + t;
}

double tan(double x)
{
    double y[2];
    unsigned q = __rem_pio2(x, y);
    double t = _kernel(y[0], y[1]);

    return q & 1 ? -1/t : t;
}
